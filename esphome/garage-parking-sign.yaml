substitutions:
  device_name: "garage-parking-sign"
  friendly_name: Garage Parking Sign

esphome:
  name: "${device_name}"
  friendly_name: "${friendly_name}"
  # compile_process_limit: 2 # This is a big config. Reduce the threading to help with performance.

esp32:
  board: esp32doit-devkit-v1
  framework:
    type: esp-idf

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password
  fast_connect: true

# Enable logging
logger:
  level: INFO

ota:
api:

sensor:
  - platform: wifi_signal
    name: "${friendly_name} - WiFi Signal"
    update_interval: 60s

  - platform: homeassistant
    name: "Remote Range Sensor - Left"
    entity_id: sensor.garage_parking_sensor_left_distance
    on_value:
      then:
        - number.set:
            id: display_number
            value: !lambda >-
              if (isnan(x)) {
                return -10;
              }
              return max( -9, min( (int)(round(x) - id(target_distance_left).state), 99 ));
        - lambda: |-
            if (isnan(x)) {
              id(light_hand).turn_off().perform();
              id(light_walk).turn_off().perform();
            } else if ((x - id(target_distance_left).state) < 3) {
              id(light_hand).turn_on().perform();
              id(light_walk).turn_off().perform();
            } else {
              id(light_hand).turn_off().perform();
              id(light_walk).turn_on().perform();
            }

output:
  - platform: ledc
    pin: 27
    id: gpio_hand
  - platform: ledc
    pin: 13
    id: gpio_walk

light:
  - platform: monochromatic
    output: gpio_hand
    default_transition_length: 0s
    icon: mdi:hand-back-left
    id: light_hand
    name: "Hand"
  - platform: monochromatic
    output: gpio_walk
    default_transition_length: 0s
    icon: mdi:walk
    id: light_walk
    name: "Walk"

  # One light strip snakes around the unit, covering both number displays.
  # See the `partition` entries below for breaking up the strip into segments.
  - platform: esp32_rmt_led_strip
    rgb_order: GRB
    pin: 14 # TODO: Set pins
    num_leds: 87
    rmt_channel: 0
    chipset: WS2812
    id: digit_display_light
    name: "Digit Full Light"
    internal: true
    default_transition_length: 0s
    # color_correct: [25%, 25%, 25%] # Dim down all?

  # Definition of the segments:
  # 1 = top
  # 2 = right top
  # 3 = right bottom
  # 4 = bottom
  # 5 = left bottom
  # 6 = left top
  # 7 = center

  - platform: partition
    name: Digit 1 Segment 1
    id: dig_1_seg_1
    internal: true
    default_transition_length: 0s
    segments:
      - id: digit_display_light
        from: 77
        to: 79
  - platform: partition
    name: Digit 1 Segment 2
    id: dig_1_seg_2
    internal: true
    default_transition_length: 0s
    segments:
      - id: digit_display_light
        from: 69
        to: 73 # 74
  - platform: partition
    name: Digit 1 Segment 3
    id: dig_1_seg_3
    internal: true
    default_transition_length: 0s
    segments:
      - id: digit_display_light
        from: 62
        to: 67
  - platform: partition
    name: Digit 1 Segment 4
    id: dig_1_seg_4
    internal: true
    default_transition_length: 0s
    segments:
      - id: digit_display_light
        from: 16
        to: 18
  - platform: partition
    name: Digit 1 Segment 5
    id: dig_1_seg_5
    internal: true
    default_transition_length: 0s
    segments:
      - id: digit_display_light
        from: 8
        to: 13 # or 12
  - platform: partition
    name: Digit 1 Segment 6
    id: dig_1_seg_6
    default_transition_length: 0s
    internal: true
    segments:
      - id: digit_display_light
        from: 1
        to: 6
  - platform: partition
    name: Digit 1 Segment 7
    id: dig_1_seg_7
    default_transition_length: 0s
    internal: true
    segments:
      - id: digit_display_light
        from: 81
        to: 83

  # Digit 2 Segments
  - platform: partition
    name: Digit 2 Segment 1
    id: dig_2_seg_1
    default_transition_length: 0s
    internal: true
    segments:
      - id: digit_display_light
        from: 42
        to: 44
  - platform: partition
    name: Digit 2 Segment 2
    id: dig_2_seg_2
    default_transition_length: 0s
    internal: true
    segments:
      - id: digit_display_light
        from: 34
        to: 39 # 38
  - platform: partition
    name: Digit 2 Segment 3
    id: dig_2_seg_3
    default_transition_length: 0s
    internal: true
    segments:
      - id: digit_display_light
        from: 28 # or 27
        to: 32
  - platform: partition
    name: Digit 2 Segment 4
    id: dig_2_seg_4
    default_transition_length: 0s
    internal: true
    segments:
      - id: digit_display_light
        from: 22
        to: 24 # 25 is end of bottom
  - platform: partition
    name: Digit 2 Segment 5
    id: dig_2_seg_5
    default_transition_length: 0s
    internal: true
    segments:
      - id: digit_display_light
        from: 54
        to: 59 # 58
  - platform: partition
    name: Digit 2 Segment 6
    id: dig_2_seg_6
    default_transition_length: 0s
    internal: true
    segments:
      - id: digit_display_light
        from: 47
        to: 52
  - platform: partition
    name: Digit 2 Segment 7
    id: dig_2_seg_7
    default_transition_length: 0s
    internal: true
    segments:
      - id: digit_display_light
        from: 84
        to: 86

number:
  - platform: template
    name: Target Distance - Left
    id: target_distance_left
    optimistic: true
    mode: box
    entity_category: config
    min_value: 0
    max_value: 99
    step: 1
    restore_value: true
    unit_of_measurement: "inches"
    icon: "mdi:map-marker-distance"

  - platform: template
    name: Target Distance - Right
    id: target_distance_right
    optimistic: true
    mode: box
    entity_category: config
    min_value: 0
    max_value: 99
    step: 1
    restore_value: true
    unit_of_measurement: "inches"
    icon: "mdi:map-marker-distance"

  - platform: template
    name: Digit Brightness
    id: digit_brightness
    optimistic: true
    mode: slider
    entity_category: config
    min_value: 0
    max_value: 100
    step: 1
    restore_value: true
    unit_of_measurement: "%"
    icon: "mdi:brightness-percent"

  - platform: template
    name: Digit Red
    id: digit_red
    optimistic: true
    mode: slider
    entity_category: config
    min_value: 0
    max_value: 100
    step: 1
    restore_value: true
    unit_of_measurement: "%"
    icon: "mdi:palette"

  - platform: template
    name: Digit Green
    id: digit_green
    optimistic: true
    mode: slider
    entity_category: config
    min_value: 0
    max_value: 100
    step: 1
    restore_value: true
    unit_of_measurement: "%"
    icon: "mdi:palette"

  - platform: template
    name: Digit Blue
    id: digit_blue
    optimistic: true
    mode: slider
    entity_category: config
    min_value: 0
    max_value: 100
    step: 1
    restore_value: true
    unit_of_measurement: "%"
    icon: "mdi:palette"

  - platform: template
    name: Display Number
    id: display_number
    optimistic: true
    mode: box
    min_value: -10 # -10 represents a clear display. All other numbers are displayable.
    max_value: 99
    initial_value: -10 # Start blank.
    step: 1
    on_value:
      then:
        - lambda: |-
            auto call_digit_1 = id(digit_1_value).make_call();
            auto call_digit_2 = id(digit_2_value).make_call();

            if (x == -10) {
              call_digit_1.set_value(-2);
              call_digit_2.set_value(-2);
              call_digit_1.perform();
              call_digit_2.perform();
              return; // Clear and return.
            }
            else if (x < 0) {
              // -1 represents a negative sign
              call_digit_1.set_value(-1);
            } else if (x < 10) {
              // -2 represents a blank value
              call_digit_1.set_value(-2);
            } else {
              call_digit_1.set_value(((int) x / 10) % 10);
            }

            call_digit_2.set_value(abs((int) x) % 10);

            call_digit_1.perform();
            call_digit_2.perform();


  # Map the number value to a set of segments.
  # Value meanings:
  #  -2 = blank
  #  -1 = - (minus sign)
  # 0-9 = normal values

  - platform: template
    name: Digit 1 Value
    id: digit_1_value
    optimistic: true
    internal: true
    mode: box
    min_value: -2
    max_value: 9
    step: 1
    on_value_range:
      - above: -2
        below: -2
        # On: none
        # Off: 1,2,3,4,5,6,7
        then:
          - light.turn_off: dig_1_seg_1
          - light.turn_off: dig_1_seg_2
          - light.turn_off: dig_1_seg_3
          - light.turn_off: dig_1_seg_4
          - light.turn_off: dig_1_seg_5
          - light.turn_off: dig_1_seg_6
          - light.turn_off: dig_1_seg_7
      - above: -1
        below: -1
        # On: 7
        # Off: 1,2,3,4,5,6
        then:
          - light.turn_off: dig_1_seg_1
          - light.turn_off: dig_1_seg_2
          - light.turn_off: dig_1_seg_3
          - light.turn_off: dig_1_seg_4
          - light.turn_off: dig_1_seg_5
          - light.turn_off: dig_1_seg_6
          - light.turn_on:
              id: dig_1_seg_7
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
      - above: 0
        below: 0
        # On: 1,2,3,4,5,6
        # Off: 7
        then:
          - light.turn_on:
              id: dig_1_seg_1
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_1_seg_2
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_1_seg_3
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_1_seg_4
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_1_seg_5
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_1_seg_6
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_off: dig_1_seg_7
      - above: 1
        below: 1
        # On: 2,3
        # Off: 1,4,5,6,7
        then:
          - light.turn_off: dig_1_seg_1
          - light.turn_on:
              id: dig_1_seg_2
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_1_seg_3
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_off: dig_1_seg_4
          - light.turn_off: dig_1_seg_5
          - light.turn_off: dig_1_seg_6
          - light.turn_off: dig_1_seg_7
      - above: 2
        below: 2
        # On: 1,2,4,5,7
        # Off: 3,6
        then:
          - light.turn_on:
              id: dig_1_seg_1
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_1_seg_2
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_off: dig_1_seg_3
          - light.turn_on:
              id: dig_1_seg_4
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_1_seg_5
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_off: dig_1_seg_6
          - light.turn_on:
              id: dig_1_seg_7
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
      - above: 3
        below: 3
        # On: 1,2,3,4,7
        # Off: 5,6
        then:
          - light.turn_on:
              id: dig_1_seg_1
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_1_seg_2
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_1_seg_3
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_1_seg_4
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_off: dig_1_seg_5
          - light.turn_off: dig_1_seg_6
          - light.turn_on:
              id: dig_1_seg_7
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
      - above: 4
        below: 4
        # On: 2,3,6,7
        # Off: 1,4,5
        then:
          - light.turn_off: dig_1_seg_1
          - light.turn_on:
              id: dig_1_seg_2
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_1_seg_3
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_off: dig_1_seg_4
          - light.turn_off: dig_1_seg_5
          - light.turn_on:
              id: dig_1_seg_6
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_1_seg_7
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
      - above: 5
        below: 5
        # On: 1,3,4,6,7
        # Off: 2,5
        then:
          - light.turn_on:
              id: dig_1_seg_1
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_off: dig_1_seg_2
          - light.turn_on:
              id: dig_1_seg_3
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_1_seg_4
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_off: dig_1_seg_5
          - light.turn_on:
              id: dig_1_seg_6
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_1_seg_7
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
      - above: 6
        below: 6
        # On: 1,3,4,5,6,7
        # Off: 2
        then:
          - light.turn_on:
              id: dig_1_seg_1
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_off: dig_1_seg_2
          - light.turn_on:
              id: dig_1_seg_3
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_1_seg_4
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_1_seg_5
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_1_seg_6
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_1_seg_7
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
      - above: 7
        below: 7
        # On: 1,2,3
        # Off: 4,5,6,7
        then:
          - light.turn_on:
              id: dig_1_seg_1
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_1_seg_2
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_1_seg_3
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_off: dig_1_seg_4
          - light.turn_off: dig_1_seg_5
          - light.turn_off: dig_1_seg_6
          - light.turn_off: dig_1_seg_7
      - above: 8
        below: 8
        # On: 1,2,3,4,5,6,7
        # Off: none
        then:
          - light.turn_on:
              id: dig_1_seg_1
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_1_seg_2
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_1_seg_3
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_1_seg_4
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_1_seg_5
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_1_seg_6
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_1_seg_7
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
      - above: 9
        below: 9
        # On: 1,2,3,4,6,7
        # Off: 5
        then:
          - light.turn_on:
              id: dig_1_seg_1
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_1_seg_2
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_1_seg_3
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_1_seg_4
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_off: dig_1_seg_5
          - light.turn_on:
              id: dig_1_seg_6
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_1_seg_7
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;

  - platform: template
    name: Digit 2 Value
    id: digit_2_value
    optimistic: true
    internal: true
    mode: box
    min_value: -2
    max_value: 9
    step: 1
    on_value_range:
      - above: -2
        below: -2
        # On: none
        # Off: 1,2,3,4,5,6,7
        then:
          - light.turn_off: dig_2_seg_1
          - light.turn_off: dig_2_seg_2
          - light.turn_off: dig_2_seg_3
          - light.turn_off: dig_2_seg_4
          - light.turn_off: dig_2_seg_5
          - light.turn_off: dig_2_seg_6
          - light.turn_off: dig_2_seg_7
      - above: -1
        below: -1
        # On: 7
        # Off: 1,2,3,4,5,6
        then:
          - light.turn_off: dig_2_seg_1
          - light.turn_off: dig_2_seg_2
          - light.turn_off: dig_2_seg_3
          - light.turn_off: dig_2_seg_4
          - light.turn_off: dig_2_seg_5
          - light.turn_off: dig_2_seg_6
          - light.turn_on:
              id: dig_2_seg_7
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
      - above: 0
        below: 0
        # On: 1,2,3,4,5,6
        # Off: 7
        then:
          - light.turn_on:
              id: dig_2_seg_1
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_2_seg_2
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_2_seg_3
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_2_seg_4
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_2_seg_5
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_2_seg_6
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_off: dig_2_seg_7
      - above: 1
        below: 1
        # On: 2,3
        # Off: 1,4,5,6,7
        then:
          - light.turn_off: dig_2_seg_1
          - light.turn_on:
              id: dig_2_seg_2
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_2_seg_3
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_off: dig_2_seg_4
          - light.turn_off: dig_2_seg_5
          - light.turn_off: dig_2_seg_6
          - light.turn_off: dig_2_seg_7
      - above: 2
        below: 2
        # On: 1,2,4,5,7
        # Off: 3,6
        then:
          - light.turn_on:
              id: dig_2_seg_1
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_2_seg_2
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_off: dig_2_seg_3
          - light.turn_on:
              id: dig_2_seg_4
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_2_seg_5
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_off: dig_2_seg_6
          - light.turn_on:
              id: dig_2_seg_7
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
      - above: 3
        below: 3
        # On: 1,2,3,4,7
        # Off: 5,6
        then:
          - light.turn_on:
              id: dig_2_seg_1
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_2_seg_2
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_2_seg_3
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_2_seg_4
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_off: dig_2_seg_5
          - light.turn_off: dig_2_seg_6
          - light.turn_on:
              id: dig_2_seg_7
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
      - above: 4
        below: 4
        # On: 2,3,6,7
        # Off: 1,4,5
        then:
          - light.turn_off: dig_2_seg_1
          - light.turn_on:
              id: dig_2_seg_2
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_2_seg_3
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_off: dig_2_seg_4
          - light.turn_off: dig_2_seg_5
          - light.turn_on:
              id: dig_2_seg_6
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_2_seg_7
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
      - above: 5
        below: 5
        # On: 1,3,4,6,7
        # Off: 2,5
        then:
          - light.turn_on:
              id: dig_2_seg_1
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_off: dig_2_seg_2
          - light.turn_on:
              id: dig_2_seg_3
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_2_seg_4
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_off: dig_2_seg_5
          - light.turn_on:
              id: dig_2_seg_6
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_2_seg_7
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
      - above: 6
        below: 6
        # On: 1,3,4,5,6,7
        # Off: 2
        then:
          - light.turn_on:
              id: dig_2_seg_1
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_off: dig_2_seg_2
          - light.turn_on:
              id: dig_2_seg_3
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_2_seg_4
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_2_seg_5
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_2_seg_6
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_2_seg_7
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
      - above: 7
        below: 7
        # On: 1,2,3
        # Off: 4,5,6,7
        then:
          - light.turn_on:
              id: dig_2_seg_1
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_2_seg_2
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_2_seg_3
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_off: dig_2_seg_4
          - light.turn_off: dig_2_seg_5
          - light.turn_off: dig_2_seg_6
          - light.turn_off: dig_2_seg_7
      - above: 8
        below: 8
        # On: 1,2,3,4,5,6,7
        # Off: none
        then:
          - light.turn_on:
              id: dig_2_seg_1
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_2_seg_2
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_2_seg_3
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_2_seg_4
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_2_seg_5
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_2_seg_6
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_2_seg_7
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
      - above: 9
        below: 9
        # On: 1,2,3,4,6,7
        # Off: 5
        then:
          - light.turn_on:
              id: dig_2_seg_1
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_2_seg_2
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_2_seg_3
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_2_seg_4
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_off: dig_2_seg_5
          - light.turn_on:
              id: dig_2_seg_6
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
          - light.turn_on:
              id: dig_2_seg_7
              red: !lambda |-
                return id(digit_red).state / 100.0;
              green: !lambda |-
                return id(digit_green).state / 100.0;
              blue: !lambda |-
                return id(digit_blue).state / 100.0;
              brightness: !lambda |-
                return id(digit_brightness).state / 100.0;
