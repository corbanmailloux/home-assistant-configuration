scene:
  - id: fe208743-4e9d-4a4c-8901-8cb4820a55ce
    name: Training
    entities:
      light.corner_lamp:
        brightness: 255
        state: "on"
      light.corban_s_office_lamp:
        brightness: 255
        state: "on"
      light.stairs_bottom_of_stairs:
        state: "on"
      light.sunporch_string_lights:
        state: "on"
      light.sunporch_sconces:
        brightness: 255
        state: "on"
    icon: mdi:trophy-outline

input_boolean:
  training_mode:
    name: Training
    icon: mdi:trophy-outline

automation:
  - alias: Training Mode Start
    id: 0306466a-8dab-4d80-b814-d0b5a7d97f31
    trigger:
      - platform: state
        entity_id: input_boolean.training_mode
        to: "on"
    action:
      - alias: "Create scene with all impacted lights"
        service: scene.create
        data:
          scene_id: state_before_training
          snapshot_entities:
            - light.corner_lamp
            - light.corban_s_office_lamp
            - light.stairs_bottom_of_stairs
            - light.sunporch_string_lights
            - light.sunporch_sconces
      - service: scene.turn_on
        target:
          entity_id: scene.training

  - alias: Training Mode Stop
    id: 6c0d187b-c08f-4e96-a602-1dd87e972df6
    trigger:
      - platform: state
        entity_id: input_boolean.training_mode
        to: "off"
    action:
      - service: scene.turn_on
        target:
          entity_id: scene.state_before_training
      - alias: "Clear notification"
        service: notify.corban
        data:
          message: "clear_notification"
          data:
            tag: "training_mode_left_on"

  - alias: Training Mode Left On Notification
    id: 1a38b478-549d-4d84-9a00-8c1ce37bddea
    trigger:
      - platform: state
        entity_id: input_boolean.training_mode
        to: "on"
        for:
          minutes: 15
    action:
      - alias: "Notify Corban"
        service: notify.corban
        data:
          title: "Training Mode Reminder"
          message: "Training mode is still on. Turn off?"
          data:
            tag: "training_mode_left_on"
            actions:
              - action: "TRAINING_TURN_OFF"
                title: "Turn off."
                activationMode: "background"
                authenticationRequired: false # Don't require unlocking the device
                destructive: false
                behavior: "default"

  - alias: Training Mode Left On - Notification Action
    id: 40261cea-1c15-4dfc-b795-ce11a932e394
    trigger:
      - platform: event
        event_type: mobile_app_notification_action
        event_data:
          action: "TRAINING_TURN_OFF"
    action:
      - service: input_boolean.turn_off
        data:
          entity_id: input_boolean.training_mode
